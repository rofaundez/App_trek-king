
<ion-content>
  <div class="contenedor-rutas">
    <!-- Header con fondo de hojas -->
    <div class="header-container">
      <div class="user-welcome">
        <ion-avatar (click)="verPerfil()" class="imagen_usuario">
          <img alt="Avatar" src="assets/default-avatar.jpg">
        </ion-avatar>
        <div class="welcome-text">
          <h2>Panel de Autoridad</h2>
          <h3>{{autoridadActual?.nombre || "Autoridad"}} {{autoridadActual?.apellido || ""}}</h3>
        </div>
        <div class="header-buttons">
          <ion-button *ngIf="puedeCrearAutoridades()" (click)="crearAutoridad()" class="action-button">
            <ion-icon name="person-add-outline" slot="icon-only"></ion-icon>
          </ion-button>
          <ion-button (click)="logout()" class="action-button">
            <ion-icon name="log-out-outline" slot="icon-only"></ion-icon>
          </ion-button>
        </div>
      </div>

      <!-- Search bar con autocompletado -->
      <div class="search-container">
        <div class="custom-searchbar">
          <input 
            type="text" 
            placeholder="Buscar rutas agendadas" 
            [(ngModel)]="searchTerm" 
            (input)="onSearch($event)" 
            class="search-input">
          <button class="search-button" *ngIf="searchTerm" (click)="searchTerm=''; onSearch($event)">
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>
        <div class="autocomplete-container" *ngIf="sugerencias && sugerencias.length > 0">
          <ul class="autocomplete-list">
            <li *ngFor="let sugerencia of sugerencias" (click)="seleccionarSugerencia(sugerencia)" class="autocomplete-item">
              {{sugerencia}}
            </li>
          </ul>
        </div>
      </div>

      <!-- Filtros para rutas agendadas -->
      <ng-container *ngIf="rutasFiltradas.length > 0; else SinRutas">
      <div class="contenedor_filtro" 
           (mousedown)="isMouseDown($event)" 
           (mousemove)="onMouseMove($event)"
           (mouseup)="isMouseUp($event)"
           (mouseleave)="isMouseUp($event)">

        <ion-button fill="clear" class="boton-filtro" [class.active-filter]="filtroActivo === 'Hoy'" (click)="filtrarPorFecha('Hoy')">
          <ion-icon name="today-outline" class="imagen_filtro"></ion-icon>
          <span class="nombre_filtro">Hoy</span>
        </ion-button>

        <ion-button fill="clear" class="boton-filtro" [class.active-filter]="filtroActivo === 'Semana'" (click)="filtrarPorFecha('Semana')">
          <ion-icon name="calendar-outline" class="imagen_filtro"></ion-icon>
          <span class="nombre_filtro">Esta semana</span>
        </ion-button>

        <ion-button fill="clear" class="boton-filtro" [class.active-filter]="filtroActivo === 'Mes'" (click)="filtrarPorFecha('Mes')">
          <ion-icon name="calendar-number-outline" class="imagen_filtro"></ion-icon>
          <span class="nombre_filtro">Este mes</span>
        </ion-button>

        <ion-button fill="clear" class="boton-filtro" [class.active-filter]="filtroActivo === 'Todas'" (click)="filtrarPorFecha('Todas')">
          <ion-icon name="infinite-outline" class="imagen_filtro"></ion-icon>
          <span class="nombre_filtro">Todas</span>
        </ion-button>
      </div>
      
    </ng-container>
    <ng-template #SinRutas>
      <div class="no-rutas-mensaje1">   
      </div>
    </ng-template>
    </div>

    <!-- Contenido de rutas agendadas -->  
    <div class="info-panel">
      <ion-icon name="information-circle-outline"></ion-icon>
      <div class="info-text">
        <h4>Rutas Agendadas por Usuarios</h4>
        <p>Aquí puede ver todas las rutas que los usuarios han agendado para realizar. Esta información le ayudará a estar preparado para brindar asistencia en caso de emergencia.</p>
      </div>
    </div>
        <div class="rutas-container">
          <div class="ruta-card" *ngFor="let ruta of rutasFiltradas">
            <div class="ruta-imagen">
              <img [src]="ruta.imagen" [alt]="ruta.nombre" />
              <div class="dificultad-badge" [style.background-color]="getDificultadColor(ruta.dificultad)">
                {{ ruta.dificultad }}
              </div>
            </div>
            <div class="ruta-info">
              <h3>{{ ruta.nombre }}</h3>
              <p class="ubicacion">{{ ruta.ubicacion }}</p>
              <p class="fecha-agendada" *ngIf="ruta.fechaProgramada">
                <ion-icon name="calendar-outline"></ion-icon>
                Agendada para: {{ ruta.fechaProgramada }}
              </p>
              <p class="hora-agendada" *ngIf="ruta.horaProgramada">
                <ion-icon name="time-outline"></ion-icon>
                Hora: {{ ruta.horaProgramada }}
              </p>
              <p class="usuario-info" *ngIf="ruta.userId">
                <ion-icon name="person-outline"></ion-icon>
                Usuario: {{ ruta.nombreUsuario || 'Nombre no disponible' }}
              </p>
              <div class="acciones">
                <ion-button fill="clear" size="small" (click)="verRuta(ruta)" title="Ver ruta en mapa">
                  <ion-icon name="map-outline" slot="start"></ion-icon>
                  Ver Ruta
                </ion-button>
                <ion-button fill="clear" size="small" (click)="verDetallesRuta(ruta)" title="Ver detalles">
                  <ion-icon name="information-circle-outline" slot="start"></ion-icon>
                  Detalles
                </ion-button>
              </div>
            </div>
          </div>
        </div>
        <div class="mensaje-vacio" *ngIf="rutasFiltradas.length === 0">
          <ion-icon name="calendar-outline"></ion-icon>
          <h3>No hay rutas agendadas disponibles</h3>
          <p>No se encontraron rutas agendadas que coincidan con los filtros seleccionados.</p>
        </div>
  </div>
</ion-content>
